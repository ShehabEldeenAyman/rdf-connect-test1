"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const node_fs_1 = require("node:fs");
const state_1 = require("../lib/state.js");
const location = "save.json";
(0, globals_1.describe)("State", () => {
    (0, globals_1.beforeEach)(() => {
        (0, node_fs_1.rmSync)(location, {
            force: true,
        });
    });
    (0, globals_1.test)("correct chaining", () => {
        const factory = new state_1.FileStateFactory(location);
        const state = factory.build("test", JSON.stringify, JSON.parse, () => []);
        (0, globals_1.expect)(state.item.length).toBe(0);
        state.item.push(5);
        state.item.push(6);
        state.item.push(7);
        factory.write();
        const save = JSON.parse((0, node_fs_1.readFileSync)(location, { encoding: "utf8" }));
        (0, globals_1.expect)(save).toEqual({ test: "[5,6,7]" });
        const factory2 = new state_1.FileStateFactory(location);
        const state2 = factory2.build("test", JSON.stringify, JSON.parse, () => []);
        (0, globals_1.expect)(state2.item.length).toBe(3);
        (0, globals_1.expect)(state2.item).toEqual([5, 6, 7]);
    });
});
